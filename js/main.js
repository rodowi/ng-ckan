define("events",[],function(){var e=angular.module("App.Events",[]);e.constant("events",{DATASETS_ERROR:"datasets_error",DATESETS_RETRIEVED:"datasets_retrieved",DATASETS_RETRIEVING:"datasets_retrieving",DATASETS_QUERY:"datasets_query",DATASETS_QUERYING:"datasets_querying",GROUPS_ERROR:"groups_error",GROUPS_RETRIEVED:"groups_retrieved",GROUPS_RETRIEVING:"groups_retrieving",GROUPS_QUERY:"groups_query",GROUPS_QUERYING:"groups_querying",ORGANIZATIONS_ERROR:"organizations_error",ORGANIZATIONS_RETRIEVED:"organizations_retrieved",ORGANIZATIONS_RETRIEVING:"organizations_retrieving",ORGANIZATIONS_QUERY:"organizations_query",ORGANIZATIONS_QUERYING:"organizations_querying"})}),define("common/CkanService",[],function(){return function(e,t,n){var r={_querying:"",_total:0,_resource:t("http://catalogo.datos.gob.mx/api/3/action/:action",null,{dataset:{method:"GET",isArray:!1,transformResponse:function(e){var t=angular.fromJson(e);return t.result}},datasets:{method:"GET",isArray:!0,transformResponse:function(e){var t=angular.fromJson(e);return r._total=t.result.count,t.result.results}},group:{method:"GET",isArray:!1,transformResponse:function(e){var t=angular.fromJson(e);return t.result}},groups:{method:"GET",isArray:!0,transformResponse:function(e){var t=angular.fromJson(e);return r._total=t.result.length,t.result}},organization:{method:"GET",isArray:!1,transformResponse:function(e){var t=angular.fromJson(e);return t.result}},organizations:{method:"GET",isArray:!0,transformResponse:function(e){var t=angular.fromJson(e);return r._total=t.result.length,t.result}}}),getEvent:function(e){switch(e){case"ERROR":if(this._querying=="datasets")return n.DATASETS_ERROR;if(this._querying=="groups")return n.GROUPS_ERROR;if(this._querying=="organizations")return n.ORGANIZATIONS_ERROR;break;case"QUERY":if(this._querying=="datasets")return n.DATASETS_QUERY;if(this._querying=="groups")return n.GROUPS_QUERY;if(this._querying=="organizations")return n.ORGANIZATIONS_QUERY;break;case"QUERYING":if(this._querying=="datasets")return n.DATASETS_QUERYING;if(this._querying=="groups")return n.GROUPS_QUERYING;if(this._querying=="organizations")return n.ORGANIZATIONS_QUERYING}},getPageSize:function(){return 10},getTotal:function(){return this._total},dataset:function(t){return e.$broadcast(n.DATASETS_RETRIEVING),this._resource.dataset({action:"package_show",id:t},function(t){while(!t.$resolved);e.$broadcast(n.DATASETS_RETRIEVED,t)})},datasets:function(t,r){return e.$broadcast(n.DATASETS_QUERYING),this._resource.datasets({action:"package_search",q:t,rows:10,start:r},function(t){while(!t.$resolved);e.$broadcast(n.DATASETS_QUERY,t)})},group:function(t){return e.$broadcast(n.GROUPS_RETRIEVING),this._resource.group({action:"group_show",all_fields:"true",id:t},function(t){while(!t.$resolved);e.$broadcast(n.GROUPS_RETRIEVED,t)})},groups:function(){return e.$broadcast(n.GROUPS_QUERYING),this._resource.groups({action:"group_list",all_fields:"true"},function(t){while(!t.$resolved);e.$broadcast(n.GROUPS_QUERY,t)})},organization:function(t){return e.$broadcast(n.ORGANIZATIONS_RETRIEVING),this._resource.organization({action:"organization_show",all_fields:!0,id:t},function(t){while(!t.$resolved);e.$broadcast(n.ORGANIZATIONS_RETRIEVED,t)})},organizations:function(){return e.$broadcast(n.ORGANIZATIONS_QUERYING),this._resource.organizations({action:"organization_list",all_fields:!0},function(t){while(!t.$resolved);e.$broadcast(n.ORGANIZATIONS_QUERY,t)})},setModel:function(e){this._querying=e}};return r}}),define("common/CommonModule",["require","common/CkanService"],function(e){var t=e("common/CkanService"),n=angular.module("CommonModule",[]);n.factory("CkanService",["$rootScope","$resource","events",t])}),define("datasets/DatasetsDetailsCtrl",[],function(){return function(e,t,n,r){e.dataset=r.dataset(t.id),e.clear=function(){e.filter=""},e.$on(n.DATASETS_RETRIEVED,function(){for(var t=0;t<e.dataset.extras.length;t++)e.dataset.extras[t].key=="dcat_publisher_email"?e.publisher_email=e.dataset.extras[t].value:e.dataset.extras[t].key=="dcat_publisher_name"&&(e.publisher_name=e.dataset.extras[t].value);$(".organization-image img").load(function(){$(this).css({"margin-top":($(".organization-image").height()-$(this).height())/2})})})}}),define("datasets/DatasetsRouter",[],function(){return function(e){e.state("datasets",{"abstract":!0,views:{"search-container":{templateUrl:"partials/datasets/search.html",controller:"DatasetsSearchCtrl"}}}).state("datasets.results",{url:"/conjuntos?page",views:{"datasets-sidebar":{templateUrl:"partials/datasets/filters.html"},"datasets-content":{templateUrl:"partials/datasets/results.html",controller:"DatasetsResultsCtrl"}},reloadOnSearch:!1}).state("datasets.details",{url:"/conjuntos/:id?page",views:{"search-container@":{templateUrl:"partials/datasets/details.html",controller:"DatasetsDetailsCtrl"}}})}}),define("datasets/DatasetsSearchCtrl",[],function(){return function(e,t,n){n.setModel("datasets");var r="",i=t.search(),s=0,o=function(){if(e.keyword){var t=e.keyword,n=t.split(" ").join("* OR ");t=t.split(" ").join(" OR "),r+="title:("+t+" OR "+n+"*)"}else r=""},u=function(){o(),n.datasets(r,s)};i.q&&(e.keyword=decodeURIComponent(i.q)),i.page&&(s=(i.page-1)*10),e.clearSearch=function(){e.keyword="",t.search("q",null),u()},e.search=function(){e.keyword?t.search("q",encodeURIComponent(e.keyword)):t.search("q",null),u()},e.$on(n.getEvent("QUERY"),function(){e.count=n.getTotal()}),e.$on("PAGE_UPDATED",function(e,n){e.preventDefault(),n>1?t.search("page",n):t.search("page",null),s=(n-1)*10,u()}),u()}}),define("common/ResultsCtrl",[],function(){return function(e,t,n,r){var i=!1;e.searching=!0,e.paginate=function(){i=!0,e.$emit("PAGE_UPDATED",e.page)},e.selectDataset=function(e){t.go("datasets.details",{id:e})},e.selectGroup=function(e){t.go("groups.details",{id:e})},e.selectOrganization=function(e){t.go("organizations.details",{id:e})},e.$on(r.getEvent("QUERYING"),function(){e.searching=!0}),e.$on(r.getEvent("QUERY"),function(t,s){t.preventDefault(),e.searching=!1,e.results=s,e.limit=r.getPageSize(),e.total=r.getTotal(),n.page&&!i&&(e.page=n.page)})}}),define("datasets/DatasetsModule",["require","datasets/DatasetsDetailsCtrl","datasets/DatasetsRouter","datasets/DatasetsSearchCtrl","common/ResultsCtrl"],function(e){var t=e("datasets/DatasetsDetailsCtrl"),n=e("datasets/DatasetsRouter"),r=e("datasets/DatasetsSearchCtrl"),i=e("common/ResultsCtrl"),s=angular.module("DatasetsModule",[]);s.config(["$stateProvider",n]),s.controller("DatasetsDetailsCtrl",["$scope","$stateParams","events","CkanService",t]),s.controller("DatasetsResultsCtrl",["$scope","$state","$stateParams","CkanService",i]),s.controller("DatasetsSearchCtrl",["$scope","$location","CkanService",r])}),define("groups/GroupsDetailsCtrl",[],function(){return function(e,t,n,r,i){e.group=i.group(n.id),e.clear=function(){e.filter=""},e.selectDataset=function(e){t.go("datasets.details",{id:e})},e.$on(r.GROUPS_RETRIEVED,function(){$(".organization-image img").load(function(){$(this).css({"margin-top":($(".organization-image").height()-$(this).height())/2})})})}}),define("groups/GroupsRouter",[],function(){return function(e){e.state("groups",{"abstract":!0,views:{"search-container":{templateUrl:"partials/datasets/search.html",controller:"GroupsSearchCtrl"}}}).state("groups.results",{url:"/grupos?page",views:{"datasets-sidebar":{templateUrl:"partials/datasets/filters.html"},"datasets-content":{templateUrl:"partials/groups/results.html",controller:"GroupsResultsCtrl"}},reloadOnSearch:!1}).state("groups.details",{url:"/grupos/:id?page",views:{"search-container@":{templateUrl:"partials/groups/details.html",controller:"GroupsDetailsCtrl"}}})}}),define("groups/GroupsSearchCtrl",[],function(){return function(e,t){t.setModel("groups");var n=function(){t.groups()};e.$on(t.getEvent("QUERY"),function(){e.count=t.getTotal()}),n()}}),define("groups/GroupsModule",["require","groups/GroupsDetailsCtrl","groups/GroupsRouter","groups/GroupsSearchCtrl","common/ResultsCtrl"],function(e){var t=e("groups/GroupsDetailsCtrl"),n=e("groups/GroupsRouter"),r=e("groups/GroupsSearchCtrl"),i=e("common/ResultsCtrl"),s=angular.module("GroupsModule",[]);s.config(["$stateProvider",n]),s.controller("GroupsDetailsCtrl",["$scope","$state","$stateParams","events","CkanService",t]),s.controller("GroupsResultsCtrl",["$scope","$state","$stateParams","CkanService",i]),s.controller("GroupsSearchCtrl",["$scope","CkanService",r])}),define("organizations/OrganizationsDetailsCtrl",[],function(){return function(e,t,n,r,i){e.organization=i.organization(n.id),e.clear=function(){e.filter=""},e.selectDataset=function(e){t.go("datasets.details",{id:e})},e.$on(r.ORGANIZATIONS_RETRIEVED,function(){$(".organization-image img").load(function(){$(this).css({"margin-top":($(".organization-image").height()-$(this).height())/2})})})}}),define("organizations/OrganizationsRouter",[],function(){return function(e){e.state("organizations",{"abstract":!0,views:{"search-container":{templateUrl:"partials/datasets/search.html",controller:"OrganizationsSearchCtrl"}}}).state("organizations.results",{url:"/instituciones?page",views:{"datasets-sidebar":{templateUrl:"partials/datasets/filters.html"},"datasets-content":{templateUrl:"partials/organizations/results.html",controller:"OrganizationsResultsCtrl"}},reloadOnSearch:!1}).state("organizations.details",{url:"/instituciones/:id?page",views:{"search-container@":{templateUrl:"partials/organizations/details.html",controller:"OrganizationsDetailsCtrl"}}})}}),define("organizations/OrganizationsSearchCtrl",[],function(){return function(e,t,n){n.setModel("organizations");var r=function(){n.organizations()};e.$on(n.getEvent("QUERY"),function(){e.count=n.getTotal()}),r()}}),define("organizations/OrganizationsModule",["require","common/ResultsCtrl","organizations/OrganizationsDetailsCtrl","organizations/OrganizationsRouter","organizations/OrganizationsSearchCtrl"],function(e){var t=e("common/ResultsCtrl"),n=e("organizations/OrganizationsDetailsCtrl"),r=e("organizations/OrganizationsRouter"),i=e("organizations/OrganizationsSearchCtrl"),s=angular.module("OrganizationsModule",[]);s.config(["$stateProvider",r]),s.controller("OrganizationsDetailsCtrl",["$scope","$state","$stateParams","events","CkanService",n]),s.controller("OrganizationsResultsCtrl",["$scope","$state","$stateParams","CkanService",t]),s.controller("OrganizationsSearchCtrl",["$scope","$location","CkanService",i])}),define("app",["require","events","common/CommonModule","datasets/DatasetsModule","groups/GroupsModule","organizations/OrganizationsModule"],function(e){e("events"),e("common/CommonModule"),e("datasets/DatasetsModule"),e("groups/GroupsModule"),e("organizations/OrganizationsModule");var t=angular.module("ngCkan",["ngResource","ui.bootstrap.pagination","ui.bootstrap.tpls","ui.router","App.Events","CommonModule","DatasetsModule","GroupsModule","OrganizationsModule"]);return t.config(["$urlRouterProvider",function(e){e.otherwise("/conjuntos")}]),t.run(["$rootScope","$state",function(e,t){e.$state=t,e.$on("$stateChangeSuccess",function(e,t){$(".nav-tabs li").removeClass("active");switch(t.name){case"datasets.results":case"datasets.details":$("#item-datasets").addClass("active");break;case"groups.results":case"groups.details":$("#item-groups").addClass("active");break;case"organizations.results":case"organizations.details":$("#item-organizations").addClass("active")}})}]),t}),require.config(),define("main",["require","app"],function(e){var t=e("app"),n=angular.element(document.getElementsByTagName("html")[0]);angular.element().ready(function(){angular.bootstrap(n,[t.name])})});